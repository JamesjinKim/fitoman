{% extends "base.html" %} 

{% block title %}작업 진행 현황{% endblock %} 

{% block content%}
<div class="container">
    <div class="table-wrapper">
        <div class="header">
            <h3 align="center">프로젝트별 일일현황</h3>
        </div>
    <form method="POST" onsubmit="handleSubmit(event)">
        <div class="col">
            <label>&nbsp;프로젝트 코드</label>
            <select id="pcode" name="pcode" onchange="updatePname()">
                <option value="">선택하세요</option>
                {% for project in all_data %}
                    <option value="{{ project.pcode }}">{{ project.pcode }}</option>
                {% endfor %}
            </select>
            <label>&nbsp;프로젝트명</label>
            <input type="text" id="pname" name="pname" value="">
            <label for="startDate">&nbsp;&nbsp;시작일&nbsp;</label>        
            <input type="date" id="startDate" name="startDate" data-date-format="yymmdd">
            <label for="endDate">&nbsp;&nbsp;종료일&nbsp;</label>        
            <input type="date" id="endDate" name="endDate" data-date-format="yymmdd">
            &nbsp;&nbsp;<button type="submit" class="btn btn-primary">조회</button>
        </div>
    </form>
    <br>
        <table class="table table-hover table-striped table-responsive-sm" id="table1">
            <thead>
                <tr>
                <th rowspan="2"></th>
                <th colspan="3">설계</th>
                <th colspan="3">전장</th>
                <th colspan="3">제어</th>
                <th colspan="3">기술</th>
                <th rowspan="3">검수</th>
                <th rowspan="2">M/D계</th>
                </tr>
                <tr>
                    <th>설계</th>
                    <th>현장지원</th>
                    <th>SET UP</th>
                    <th>설계</th>
                    <th>현장지원</th>
                    <th>SET UP</th>
                    <th>PC제어</th>
                    <th>PLC제어</th>
                    <th>SET UP</th>
                    <th>조립</th>
                    <th>현장관리</th>
                    <th>SET UP</th>
                </tr>
            </thead>
            <tbody id="dateTable">
                <!-- Rows will be generated here -->
            </tbody>
        </table>
    </div>
</div>

    <script>
        // JavaScript to generate dates, weekdays, and populate the table
        //const endDate = new Date(2024, 8, 31);  // Ending at
        const startDate = new Date(); // Starting from today const startDate = new Date(); 
        // 이달의 마지막 날로 endDate 설정
        const endDate = new Date(startDate.getFullYear(), startDate.getMonth() + 1, 0);
        const dateTable = document.getElementById('dateTable');
        const excludedDates = [ ];

        const daysOfWeek = ['일', '월', '화', '수', '목', '금', '토']; // Array of weekdays
        console.log("오늘 날짜:", startDate.toLocaleDateString());
        console.log("이달의 마지막 날짜:", endDate.toLocaleDateString());
        
        function formatDate(date) {
            let month = String(date.getMonth() + 1).padStart(2, '0');
            let day = String(date.getDate()).padStart(2, '0');
            return `${month}월 ${day}일`;
        }

        for (let d = new Date(startDate); d < endDate; d.setDate(d.getDate() + 1)) {
                let row = dateTable.insertRow();
                let cell1 = row.insertCell(0);
                let cell2 = row.insertCell(1);
                let cell3 = row.insertCell(2);
                let cell4 = row.insertCell(3);
                let cell5 = row.insertCell(4);
                let cell6 = row.insertCell(5);
                let cell7 = row.insertCell(6);
                let cell8 = row.insertCell(7);
                let cell9 = row.insertCell(8);
                let cell10 = row.insertCell(9);
                let cell11 = row.insertCell(10);
                let cell12 = row.insertCell(11);
                let cell13 = row.insertCell(12);
                let cell14 = row.insertCell(13);
                let cell15 = row.insertCell(14);
                
                cell1.innerHTML = formatDate(d) + "(" + daysOfWeek[d.getDay()] + ")";
                cell2.innerHTML = ""; // Get the day of the week
                cell3.innerHTML = "";
                cell4.innerHTML = "";
                cell5.innerHTML = "";
                cell6.innerHTML = "";
                cell7.innerHTML = "";
                cell8.innerHTML = "";
                cell9.innerHTML = "";
                cell10.innerHTML = "";
                cell11.innerHTML = "";
                cell12.innerHTML = "";
                cell13.innerHTML = "";
                cell14.innerHTML = "";
                cell15.innerHTML = "";

        }

        //<form> 입력값 유지하기
        function handleSubmit(event) {
            event.preventDefault(); // 폼 제출을 막음
            //alert("폼이 제출되었지만 페이지는 새로고침되지 않았습니다.");
        }

        // Jinja2에서 전달된 데이터를 JavaScript 객체로 변환
        var projectData = {
            {% for project in all_data %}
                "{{ project.pcode }}": "{{ project.pname }}",
            {% endfor %}
        };
    
        // pcode 선택 시 pname 업데이트
        function updatePname() {
            var selectedPcode = document.getElementById("pcode").value;
            var pnameInput = document.getElementById("pname");
    
            if (selectedPcode in projectData) {
                pnameInput.value = projectData[selectedPcode];
            } else {
                pnameInput.value = "";  // 선택이 없는 경우
            }
        }

        src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"    
    </script>
    
    
    {% endblock %}
